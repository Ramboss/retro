                              РАДЧЕНКО Л.И.
                            КОМПЛЕКС ПРОГРАММ
            РАСШИРЕНИЙ ПРЕРЫВАНИЙ БАЗОВОЙ СИСТЕМЫ ВВОДА-ВЫВОДА
                      "К О П И Р О В Щ И К    вып.6".
                             Москва, 1991.

       Комплекс программ "Копировщик вып.6" предназначен для использования
на ЭВМ  ПОИСК, работающей с MS DOS в оболочке NORTON  COMMANDER, для расширения
прерываний базовой системы ввода-вывода этой ЭВМ.

       Комплекс состоит из 21 программы:
       COPYM.COM - пофайловый  копировщик магнитофонных версий программ,
       FORMP360.BAT - программа форматирования диска на 360 кбайт,
       FORMP730.BAT - программа форматирования диска на 730 кбайт,
       FP730.COM - программа форматирования диска,
       CLVD.COM - программа очистки и начальной установки виртуального диска,
       CLAV.COM - программы отображения расширенных кодов клавиатуры,
       INT5.ASM, INT5.COM - текст и программа печати на принтере содержимого
экрана,
       INT5FILE.COM - программа сброса в отдельный файл содержимого экрана,
       NUINT5F.COM - программа начальной установки параметров драйвера int5file,
       INT14.ASM, INT14.COM - драйвер передачи информации по последовательному
каналу (ИРПС),
       INT16LEX.ASM, INT16LEX.COM - программа перекодировки расширенных кодов
ПОИСКа в расширенные коды ЕС-1840,
       INT17.COM, INT17-12.COM, INT17-13.COM, INT17-37.ASM, INT17-37.COM -
текст и программы вывода информации на различные принтеры,
       JOYSTICK.COM - драйвер джойстика,
       INTDOC.DOC - документация на комплекс программ.

       Для полной реализации возможностей комплекса программ желательно иметь
ЭВМ ПОИСК в следующей конфигурации:
       системный модуль,
       один-два блока расширения памяти В107,
       внешнее запоминающее устройство ВЗУ-2,3 (адаптер дискового накопителя
В504 и один-два дисковода),
       блок питания,
       магнитофон.
       В качестве операционной системы может применяться MS DOS версии не ниже
3.30 и NORTON COMMANDER. В составе системного обеспечения желательно иметь
файлы: IBMBIO.COM, IBMDOS.COM, ANSI.SYS, AUTOEXEC.BAT, COMMAND.COM, CONFIG.SYS,
NC.EXE, NC.INI, VDISK.SYS.
       Для инициализации всей системы надо вставить диск в дисковод и сделать
перезапуск компьютера.
       Для того, чтобы требуемые пользователю драйверы загружались вместе с
системой, их имена надо включить в файл AUTOEXEC.BAT. В поставляемой версии
этого файла все имена программ, расширяющих базовую систему ввода-вывода,
включены через rem:. То есть при загрузке системы все эти файлы инициализиро-
ваны не будут. Поэтому, если надо какую-нибудь программу инициализировать при
загрузке системы, то в файле AUTOEXEC.BAT необходимо стереть перед именем этой
программы стереть rem:. Все программы могут быть инициализированы путем запус-
ка обычным способом, после чего они остаются резидентными в памяти.
       В настоящее время у пользователей имеется довольно значительный набор
принтеров и других устройств, которые желательно бы подключить к ПОИСКу.
Практически для каждого из них надо иметь свой вариант расширений базовой
системы ввода-вывода. Учесть все возможные алгоритмы работы этих устройств не
представляется возможным. Поэтому вместе с программами в комплексе представле-
ны тексты этих программ на языке ассемблер. При необходимости разработать
драйвер для нестандартного устройства пользователь всегда сможет отредактиро-
вать соответствующий текст и, с помощью ассемблирования, получить нужную
программу.


       ПОФАЙЛОВЫЙ КОПИРОВЩИК МАГНИТОФОННЫХ ВЕРСИЙ ПРОГРАММ COPY.COM.
       Копировщик предназначен для пофайлового копирования магнитофонных
версий программ на магнитофон. После его запуска на экран выводится перечень
режимов копировщика:
       1 - запись файла в формате ПОИСКА,
       2 - запись файла в формате МС 1502,
       3 - запись файла в формате БК 0010,
       4 - чтение первого найденного файла в формате ПОИСКА,
       5 - чтение требуемого файла в формате ПОИСКА,
       6 - чтение первого найденного файла в формате МС 1502,
       7 - чтение требуемого файла в формате МС 1502,
       8 - чтение первого найденного файла в формате БК 0010,
       9 - чтение требуемого файла в формате БК 0010,
       I - перекодирование текстовых файлов для БК 0010 в текстовые файлы для
IBM совместимых машин,
       B - перекодирование текстовых файлов для IBM совместимых машин в тексты
для БК 0010.
       Q -  выход в  MS DOS.
       Выбор операций желательно осуществлять набором на дополнительной клави-
атуре, переключив её в цифровой режим.
       Для прерывания операций чтения надо нажать любую клавишу на дополнитель-
ной клавиатуре.
       После выбора операции чтения требуемого файла курсор перемещается в ок-
но индикации имени ЗАГРУЖЕН ФАЙЛА: , после чего программа ждет ввода имени
файла для считывания. Имя не должно превышать 8 символов.



       ПРОГРАММЫ ФОРМАТИРОВАНИЯ ДИСКА - FORMP730.BAT, FORMP360.BAT,FP730.COM.
       При однодисковой конфигурации Поиска драйвер дисковода обеспечивает
при обращении к диску A: работу с дискетами, отформатированными на 720-730
кбайт, а при обращении к диску C: работу с дискетами на 360 кбайт.
       Особенностью адаптера Поиска является то, что при опросе его параметров
они оказываются не совпадающими с параметрами, заложенными в известных про-
граммах форматирования.
       Поэтому разработаны версии программ форматирования, которые позволяют
отформатировать диск A: на ёмкость 730 кбайт, а диск C: на ёмкость 360 кбайт.
Соответствующее форматирование производится вызовом программ FORMP730.BAT и
FORMP360.BAT.


       ПРОГРАММА ОЧИСТКИ И НАЧАЛЬНОЙ УСТАНОВКИ ВИРТУАЛЬНОГО ДИСКА CLVD.COM.
       Программа предназначена для очистки и начальной установки виртуального
диска. Она не требует никакого управления. Применять её желательно перед
формированием на виртуальном диске пакета файлов для тиражирования.
       При первом использовании программы после запуска MS DOS возможна си-
туация, когда виртуальный диск очищен, а на панели индикации содержимого этого
диска в NORTON COMMANDER остаются выведенными имена файлов. Для стирания их
надо перейти на другую панель и дать два раза команду CTRL/L.


       ПРОГРАММА ПЕЧАТИ ЭКРАНА INT5.ASM, INT5.COM.
       Данная программа позволяет выводить на стандартное устройство печати
копию изображения на экране в текстовом режиме.
       Для вызова исполнения функции данной программы (если она была инициа-
лизирована) надо нажать на верхнем регистре клавишу ПЧ(*) или дать команду
INT5.
       Программа не использует никаких параметров и не возвращает результата.
Для управления печатью экрана она использует байт памяти с абсолютным адресом
500H. Перед выдачей INT5 полезно проверить его значение:
       0 - функция печати экрана готова к выполнению (предыдущий вызов INT5
успешно завершен),
       1 - функция выполняется, сделанный в этом состоянии запрос печати
экрана будет игнорироваться,
       FFH (255) - вызов INT5 не был успешно завершен.
       По завершению функции печати экрана подается звукой сигнал.


       ПРОГРАММА ЗАПИСИ СОДЕРЖИМОГО ЭКРАНА В ФАЙЛ INT5FILE.COM.
       Данная программа позволяет запись копию изображения экрана в текстовый
файл, размещаемый на виртуальном диске.
       Для вызова исполнения функции данной программы надо также нажать на
верхнем регистре клавишу ПЧ(*) или программно дать команду INT5.
       Одновременно программы INT5 и INT5FILE функционировать не могут. По-
этому инициализироваться должна одна из этих программ.
       Программа INT5FILE.COM в качестве буфера для записи содержимого экрана
использует виртуальный диск, размещаемый в адресуемой оперативной первым.
При каждом исполнении записи экрана в на виртуальном диске создается файл
длиной 2000 байт. Они размещаются последовательно на виртуальном диске.
Нумерация файлов  file  nn.scr, в которые записывают копии, определяется номе-
ром обращения к функции этой программы. Следует учесть, что данная функция
записывает в каталог имена файлов-копий подряд, не учитывая, есть ли там ка-
кие-либо имена или нет. Поэтому желательно перед использованием функций записи
копий очистить виртуальный диск с помощью программы CLVD.COM. Нумерация копий
в этом случае будет продолжена. Максимальное число копий, создаваемое програм-
мой равно максимальному числу имен в каталоге. Для очистки виртуального диска
с установкой начальной нумерацией копий надо использовать программу NUINT5F.COM.
       Данная программа не использует никаких параметров и не возвращает ре-
зультата. Для управления используется байт памяти с абсолютным адресом 500H,
перед выдачей вызова INT5 полезно проверить его значение аналогично описанному
выше.

       ПРОГРАММА НАЧАЛЬНОЙ УСТАНОВКИ NUINT5F.COM.
       Программа выполняет начальную установку функции INT5FILE.COM - очищает
виртуальный диск, устанавливает номер следующей записываемой копии равным 1.
       Данная программа не использует никаких параметров и не возвращает
результата.


       ПРОГРАММА РАБОТЫ ПО ПОСЛЕДОВАТЕЛЬНОМУ КАНАЛУ INT14.ASM, INT14.COM.
       Данная программа предоставляет возможность передачи информации по
последовательному каналу (ИРПС).
       Для управления имеются следующие функции, которые определяются в AH:
       0H - инициализировать последовательный порт, причем в AL четыре млад-
ших разряда определяют длину слова, количество стоп битов и код четности, а
три старших разряда - скорость обмена по последовательному каналу;
       1H - послать символ через последовательный порт, причем в AL должен
быть посылаемый символ. Если произошла ошибка, то при выходе из прерывания
INT14 будет установлен бит 7 в AH;
       2H - получить символ через последовательный канал. На выходе в AL -
полученный символ и AH ненулевой, если произошла ошибка.
       Соответствующие номера портов, линий подробно описаны в инструкции по
эксплуатации адаптера интерфейсного ПОИСКа.


       ПРОГРАММА ПЕРЕКОДИРОВКИ РАСШИРЕННЫХ КОДОВ INT16LEX.ASM, INT16LEX.COM.
       Одним из недостатков ПОИСКа является тот факт, что расширенная коди-
ровка (скан-код + код символа) клавиатуры ПОИСКа не совпадает с расширенной
кодировкой довольно распространенной ЭВМ ЕС-1840, что вызывает неудобство при
использовании программ, созданных на последней машине. Например, отличается
расширенная кодировка клавиш "Б", "Ю", "Ё", "Ж", "Э", "Х", "Ъ".
       Резидентная программа INT16LEX.COM позволяет устранить этот недостаток.
После инициализации программа обеспечивает перехват прерывания INT16 и осу-
ществляет перекодировку расширенных кодов символов в соответствии с кодировкой
ЕС-1840.
       Никаких входных и выходных параметров не используется.


       ПРОГРАММА ПРОВЕРКИ РАСШИРЕННЫХ КОДОВ CLAV.COM.
       Программа предназначена для проверки расширенных кодов, вырабатываемых
контроллером клавиатуры вместе с обработчиком прерывания INT16 при нажатии
клавиши.
       После запуска программы и нажатия любой клавиши на экран выводится
изображение соответствующего символа и через пробел соответствующий ему расши-
ренный код, причем первые две цифры характеризуют скан-код, а вторые две цифры
характеризуют код символа.
       Для обеспечения проверки расширенных кодов всех клавиш при всех ре-
гистрах выход их данной программы отсутствует. Поэтому выхода из программы
необходим перезапуск ПОИСКа.


       ПРОГРАММЫ ВЫВОДА ИНФОРМАЦИИ НА ПРИНТЕРЫ.
       В комплекте программ представлены расширения базовой системы ввода-вы-
вода для работы с принтерами МС6312 (INT17-12.COM), МС6313 (INT17-13.COM),
СМ6337 (INT17-37.ASM, INT17-37.COM), EPSON (INT17.COM).
       Эти программы обеспечивают минимальные средства поддержки печатающих
устройств.
       При обращении к ним через программное прерывание INT17 в AL должен
быть код передаваемого символа. При выходе AH=80H означает, что передача
прошла нормально. Указанные программы при выводе символа на печатающее уст-
ройство обеспечивают перекодировка символов в соответствии с принятой для
данного устройства печати. При необходимости разработки нового расширения для
работы с другими принтерами можно воспользоваться текстом программ на ассемб-
лере, отредактировав их и оттранслировав с помощью соответствующих программ.
       Подробное описание портов последовательного интерфейса, назначение его
линий дано в описании Адаптера интерфейсного ПОИСКа.


       ДРАЙВЕР ДЖОЙСТИКА JOYSTICK.COM.
       Драйвер джщйстика воспринимает сигналы от игрового манипулятора и
вырабатывает расширенные скан-коды аналогично контроллеру клавиатуры и записы-
вает их в буфер клавиатуры.
       Поставляемый драйвер настроен на выработку следующих скан-кодов:
       наклон влево - перемещение курсора влево,
       наклон вправо - перемещение курсора вправо,
       наклон вперед - перемещение курсора вверх,
       наклон назад - перемещение курсора вниз,
       верхняя кнопка - табуляция,
       нижняя кнопка - ввод.
       При необходимости перекодировки надо нажать клавиши ALT+F10. При этом
драйвер переходит в режим эмуляции клавиш клавиатуры. На запросы программы
надо нажимать те клавиши на клавиатуре с теми регистрами, коды которых должны
вырабатываться при сигналах с джойстика. Перекодировку желательно производить
в то время, когда исполняемая в настоящее время программа не требует ввода
каких-либо длинных директив. Например, перекодировку нежелательно делать
в MS DOS, когда она запрашивает ввода имен файлов на загрузку - может произойти
очень долгий поиск на диске файла с именем, соответствующим всей текстовой
информации, выводимой при перекодировки.
       В программе можно изменить частоту выдачи кодов символов. Для этого
надо с помощью отладчика по адресу 0:22 посмотреть значение сегмента CS, в ко-
тором располагается драйвер. После чего по адресу CS:2C6H записать команду
на языке ассемблера:  MOV BYTE PTR [11C], N , где N означает во сколько раз
надо уменьшить частоту выдачи символов драйвером.

